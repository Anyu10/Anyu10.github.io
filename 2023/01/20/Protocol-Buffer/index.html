<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"anyu10.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.14.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="SyntaxOverviewField Numbers Field numbers in the range 1 through 15 take one byte to encode Field numbers in the range 16 through 2047 take two bytes Field numbers through 19000 to 19999 is reserved f">
<meta property="og:type" content="article">
<meta property="og:title" content="Protocol Buffer">
<meta property="og:url" content="http://anyu10.github.io/2023/01/20/Protocol-Buffer/index.html">
<meta property="og:site_name" content="Anyu">
<meta property="og:description" content="SyntaxOverviewField Numbers Field numbers in the range 1 through 15 take one byte to encode Field numbers in the range 16 through 2047 take two bytes Field numbers through 19000 to 19999 is reserved f">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-01-20T13:20:46.000Z">
<meta property="article:modified_time" content="2023-01-21T15:35:13.082Z">
<meta property="article:author" content="Anyu Elin">
<meta property="article:tag" content="Protobuf">
<meta property="article:tag" content="RPC">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://anyu10.github.io/2023/01/20/Protocol-Buffer/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://anyu10.github.io/2023/01/20/Protocol-Buffer/","path":"2023/01/20/Protocol-Buffer/","title":"Protocol Buffer"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Protocol Buffer | Anyu</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Anyu</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Syntax"><span class="nav-number">1.</span> <span class="nav-text">Syntax</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Overview"><span class="nav-number">1.1.</span> <span class="nav-text">Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Field-Numbers"><span class="nav-number">1.1.1.</span> <span class="nav-text">Field Numbers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Field-Rules"><span class="nav-number">1.1.2.</span> <span class="nav-text">Field Rules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scalar-Value-Types"><span class="nav-number">1.1.3.</span> <span class="nav-text">Scalar Value Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Default-Values"><span class="nav-number">1.1.4.</span> <span class="nav-text">Default Values</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enumerations"><span class="nav-number">1.1.5.</span> <span class="nav-text">Enumerations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Importing-Definitions"><span class="nav-number">1.1.6.</span> <span class="nav-text">Importing Definitions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Updating-a-Message-Type"><span class="nav-number">1.2.</span> <span class="nav-text">Updating a Message Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unknown-Fields"><span class="nav-number">1.3.</span> <span class="nav-text">Unknown Fields</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Any"><span class="nav-number">1.4.</span> <span class="nav-text">Any</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Oneof"><span class="nav-number">1.5.</span> <span class="nav-text">Oneof</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Features"><span class="nav-number">1.5.1.</span> <span class="nav-text">Features</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compatibility-Issue"><span class="nav-number">1.5.2.</span> <span class="nav-text">Compatibility Issue</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Maps"><span class="nav-number">1.6.</span> <span class="nav-text">Maps</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Features-1"><span class="nav-number">1.6.1.</span> <span class="nav-text">Features</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backward-Compatibility"><span class="nav-number">1.6.2.</span> <span class="nav-text">Backward Compatibility</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Defining-a-Service"><span class="nav-number">1.7.</span> <span class="nav-text">Defining a Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON-Mapping"><span class="nav-number">1.8.</span> <span class="nav-text">JSON Mapping</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Encoding"><span class="nav-number">2.</span> <span class="nav-text">Encoding</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Principles"><span class="nav-number">2.1.</span> <span class="nav-text">Principles</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Techniques"><span class="nav-number">3.</span> <span class="nav-text">Techniques</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Steaming-Multiple-Messages"><span class="nav-number">3.1.</span> <span class="nav-text">Steaming Multiple Messages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Large-Data-Sets"><span class="nav-number">3.2.</span> <span class="nav-text">Large Data Sets</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Self-Describing-Messages"><span class="nav-number">3.3.</span> <span class="nav-text">Self-Describing Messages</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Fields-Presence"><span class="nav-number">4.</span> <span class="nav-text">Fields Presence</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Presence-Disciplines"><span class="nav-number">4.1.</span> <span class="nav-text">Presence Disciplines</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Presence-in-Wire-Format"><span class="nav-number">4.2.</span> <span class="nav-text">Presence in Wire Format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Presence-in-Proto-3"><span class="nav-number">4.3.</span> <span class="nav-text">Presence in Proto 3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Semantics-of-Presence"><span class="nav-number">4.4.</span> <span class="nav-text">Semantics of Presence</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Merging"><span class="nav-number">4.4.1.</span> <span class="nav-text">Merging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compatibility"><span class="nav-number">4.4.2.</span> <span class="nav-text">Compatibility</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Styles"><span class="nav-number">5.</span> <span class="nav-text">Styles</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Anyu Elin"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Anyu Elin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://anyu10.github.io/2023/01/20/Protocol-Buffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Anyu Elin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anyu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Protocol Buffer | Anyu">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Protocol Buffer
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-01-20 21:20:46" itemprop="dateCreated datePublished" datetime="2023-01-20T21:20:46+08:00">2023-01-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-21 23:35:13" itemprop="dateModified" datetime="2023-01-21T23:35:13+08:00">2023-01-21</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>2.6k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>10 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="Field-Numbers"><a href="#Field-Numbers" class="headerlink" title="Field Numbers"></a>Field Numbers</h3><ul>
<li>Field numbers in the range 1 through 15 take one byte to encode</li>
<li>Field numbers in the range 16 through 2047 take two bytes</li>
<li>Field numbers through 19000 to 19999 is reserved for implementation</li>
<li>Largest field number is $2^{29}-1$, or $536,870,911$</li>
</ul>
<h3 id="Field-Rules"><a href="#Field-Rules" class="headerlink" title="Field Rules"></a>Field Rules</h3><ul>
<li><code>singular</code>: a well-formed message can have zero or one of this field<ul>
<li>Whether or not it’s parsed from the wire cannot be determined</li>
<li>When set to default value, it will not be included when serializing</li>
</ul>
</li>
<li><code>optional</code>: the same as <code>singular</code>, except it check whether the value was explicitly set.<ul>
<li>If the field is set, and contains a value that was explicitly set or parsed from the wire. It will be serialized to the wire.</li>
<li>If the field is unset, it will return the default value, and will not be serialized to the wire.</li>
</ul>
</li>
<li><code>repeated</code>: this field type can be repeated zero or more times in a well-formed message.</li>
<li><code>map</code>: this is a paired key&#x2F;value field type.</li>
</ul>
<h3 id="Scalar-Value-Types"><a href="#Scalar-Value-Types" class="headerlink" title="Scalar Value Types"></a>Scalar Value Types</h3><table>
<thead>
<tr>
<th align="left">.proto Type</th>
<th align="left">Notes</th>
<th align="left">C++ Type</th>
<th align="left">Java&#x2F;Kotlin Type</th>
<th align="left">Python Type</th>
<th align="left">Go Type</th>
<th align="left">Ruby Type</th>
<th align="left">C# Type</th>
<th align="left">PHP Type</th>
<th align="left">Dart Type</th>
</tr>
</thead>
<tbody><tr>
<td align="left">double</td>
<td align="left"></td>
<td align="left">double</td>
<td align="left">double</td>
<td align="left">float</td>
<td align="left">float64</td>
<td align="left">Float</td>
<td align="left">double</td>
<td align="left">float</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left"></td>
<td align="left">float</td>
<td align="left">float</td>
<td align="left">float</td>
<td align="left">float32</td>
<td align="left">Float</td>
<td align="left">float</td>
<td align="left">float</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">int32</td>
<td align="left">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint32 instead.</td>
<td align="left">int32</td>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">int32</td>
<td align="left">Fixnum or Bignum (as required)</td>
<td align="left">int</td>
<td align="left">integer</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">int64</td>
<td align="left">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint64 instead.</td>
<td align="left">int64</td>
<td align="left">long</td>
<td align="left">int&#x2F;long</td>
<td align="left">int64</td>
<td align="left">Bignum</td>
<td align="left">long</td>
<td align="left">integer&#x2F;string</td>
<td align="left">Int64</td>
</tr>
<tr>
<td align="left">uint32</td>
<td align="left">Uses variable-length encoding.</td>
<td align="left">uint32</td>
<td align="left">int</td>
<td align="left">int&#x2F;long</td>
<td align="left">uint32</td>
<td align="left">Fixnum or Bignum (as required)</td>
<td align="left">uint</td>
<td align="left">integer</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">uint64</td>
<td align="left">Uses variable-length encoding.</td>
<td align="left">uint64</td>
<td align="left">long</td>
<td align="left">int&#x2F;long</td>
<td align="left">uint64</td>
<td align="left">Bignum</td>
<td align="left">ulong</td>
<td align="left">integer&#x2F;string</td>
<td align="left">Int64</td>
</tr>
<tr>
<td align="left">sint32</td>
<td align="left">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s.</td>
<td align="left">int32</td>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">int32</td>
<td align="left">Fixnum or Bignum (as required)</td>
<td align="left">int</td>
<td align="left">integer</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">sint64</td>
<td align="left">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s.</td>
<td align="left">int64</td>
<td align="left">long</td>
<td align="left">int&#x2F;long</td>
<td align="left">int64</td>
<td align="left">Bignum</td>
<td align="left">long</td>
<td align="left">integer&#x2F;string</td>
<td align="left">Int64</td>
</tr>
<tr>
<td align="left">fixed32</td>
<td align="left">Always four bytes. More efficient than uint32 if values are often greater than 228.</td>
<td align="left">uint32</td>
<td align="left">int</td>
<td align="left">int&#x2F;long</td>
<td align="left">uint32</td>
<td align="left">Fixnum or Bignum (as required)</td>
<td align="left">uint</td>
<td align="left">integer</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">fixed64</td>
<td align="left">Always eight bytes. More efficient than uint64 if values are often greater than 256.</td>
<td align="left">uint64</td>
<td align="left">long</td>
<td align="left">int&#x2F;long</td>
<td align="left">uint64</td>
<td align="left">Bignum</td>
<td align="left">ulong</td>
<td align="left">integer&#x2F;string</td>
<td align="left">Int64</td>
</tr>
<tr>
<td align="left">sfixed32</td>
<td align="left">Always four bytes.</td>
<td align="left">int32</td>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">int32</td>
<td align="left">Fixnum or Bignum (as required)</td>
<td align="left">int</td>
<td align="left">integer</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">sfixed64</td>
<td align="left">Always eight bytes.</td>
<td align="left">int64</td>
<td align="left">long</td>
<td align="left">int&#x2F;long</td>
<td align="left">int64</td>
<td align="left">Bignum</td>
<td align="left">long</td>
<td align="left">integer&#x2F;string</td>
<td align="left">Int64</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left"></td>
<td align="left">bool</td>
<td align="left">boolean</td>
<td align="left">bool</td>
<td align="left">bool</td>
<td align="left">TrueClass&#x2F;FalseClass</td>
<td align="left">bool</td>
<td align="left">boolean</td>
<td align="left">bool</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">A string must always contain UTF-8 encoded or 7-bit ASCII text, and cannot be longer than 232.</td>
<td align="left">string</td>
<td align="left">String</td>
<td align="left">str&#x2F;unicode</td>
<td align="left">string</td>
<td align="left">String (UTF-8)</td>
<td align="left">string</td>
<td align="left">string</td>
<td align="left">String</td>
</tr>
<tr>
<td align="left">bytes</td>
<td align="left">May contain any arbitrary sequence of bytes no longer than 232.</td>
<td align="left">string</td>
<td align="left">ByteString</td>
<td align="left">str (Python 2) bytes (Python 3)</td>
<td align="left">[]byte</td>
<td align="left">String (ASCII-8BIT)</td>
<td align="left">ByteString</td>
<td align="left">string</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="Default-Values"><a href="#Default-Values" class="headerlink" title="Default Values"></a>Default Values</h3><p>The default value for repeated fields is empty</p>
<p>Default value for message type is dependent on languages</p>
<p>For scalar message fields, once a message is parsed there’s <strong>no way of telling whether a field was explicitly set to the default value</strong></p>
<h3 id="Enumerations"><a href="#Enumerations" class="headerlink" title="Enumerations"></a>Enumerations</h3><p>enum’s first constant must map to zero</p>
<p><code>option allow_alias = true;</code> can be used to define alias</p>
<h3 id="Importing-Definitions"><a href="#Importing-Definitions" class="headerlink" title="Importing Definitions"></a>Importing Definitions</h3><p><code>import public &quot;xx.proto&quot;</code> will allow proto files which import this proto file to use the definitions in xx.proto. </p>
<h2 id="Updating-a-Message-Type"><a href="#Updating-a-Message-Type" class="headerlink" title="Updating a Message Type"></a>Updating a Message Type</h2><p>Changing, adding, or removing fields:</p>
<ul>
<li><strong>Don’t change the field numbers</strong> for any existing fields.</li>
<li>When <strong>adding new fields</strong><ul>
<li>old message format can be parsed by new code (but new code should take care of default value)</li>
<li>new message format can be parsed by old code (old code just ignore the new fields)</li>
</ul>
</li>
<li>Fields can be removed when the fields are no longer used<ul>
<li>the field name and tag should be reserved</li>
<li>or add OBSELETE_ prefix to the field name</li>
</ul>
</li>
</ul>
<p>Compatible types:</p>
<ul>
<li><code>int32</code>, <code>uint32</code>, <code>int64</code>, <code>uint64</code>, and <code>bool</code> are all compatible</li>
<li><code>sint32</code> and <code>sint64</code> are compatible with each other</li>
<li><code>string</code> and <code>bytes</code> are compatible as long as the bytes are valid UTF-8</li>
<li><code>Embedded messages</code> are compatible with <code>bytes</code> if <strong>the bytes contain an encoded version of the message</strong></li>
<li><code>fixed32</code> is compatible with <code>sfixed32</code>, and <code>fixed64</code> with <code>sfixed64</code></li>
<li>For <code>string</code>, <code>bytes</code>, and <code>message fields</code>, <code>singular</code> fields are compatible with <code>repeated</code> fields<ul>
<li>For serialized repeated data as input, clients who expect singular field will take the last input.</li>
<li>not safe for numeric types, such as <code>int</code>, <code>bool</code>, and <code>enum</code>. Because repeated fields of numeric types can be serialized in the <a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/encoding#packed">packed</a> format, which will not be parsed correctly when a singular field is expected.</li>
</ul>
</li>
</ul>
<p>Binary compatible but possibly API incompatible types:</p>
<ul>
<li><code>enum</code> is compatible with <code>int32</code>, <code>uint32</code>, <code>int64</code>, and <code>uint64</code> in terms of wire format<ul>
<li>But client code may treat them differently when the message is deserialized</li>
</ul>
</li>
<li>Changing a single <code>optional</code> field or extension into a member of a <strong>new</strong> <code>oneof</code> is binary compatible<ul>
<li>For Go, the API will change in incompatible ways</li>
</ul>
</li>
</ul>
<h2 id="Unknown-Fields"><a href="#Unknown-Fields" class="headerlink" title="Unknown Fields"></a>Unknown Fields</h2><ul>
<li>Before versions 3.5, unknown fields are <strong>discarded</strong></li>
<li>In versions 3.5 and later, unknown fields are <strong>retained</strong> and included in the serialized output.</li>
</ul>
<h2 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h2><p><code>Any</code> message type:</p>
<ul>
<li>allow using messages as embedded types without having their .proto definition</li>
<li>contains <code>bytes</code> and a <code>URL</code> which is unique identifier to that message’s type</li>
<li>to use <code>Any</code>, <code>&quot;google/protobuf/any.proto&quot;</code> should be imported</li>
<li>default type URL for a given message type is <code>type.googleapis.com/_packagename_._messagename_</code></li>
</ul>
<h2 id="Oneof"><a href="#Oneof" class="headerlink" title="Oneof"></a>Oneof</h2><h3 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h3><p>When at most one field will be set at the same time, use oneof to enforce this behavior and save memory.</p>
<ul>
<li>Oneof fields are like regular fields</li>
<li>All the fields in a oneof share memory</li>
<li>At most one field in oneof can be set at the same time</li>
<li>if <em>multiple values are set, the last set value as determined by the order in the proto will overwrite all previous ones</em>.</li>
<li>Oneof fields can be any type except <code>map</code> and <code>repeated</code> fields</li>
<li>If you set a oneof field to the default value (such as setting an int32 oneof field to 0), the “case” of that oneof field will be set, and the value will be serialized on the wire.</li>
</ul>
<h3 id="Compatibility-Issue"><a href="#Compatibility-Issue" class="headerlink" title="Compatibility Issue"></a>Compatibility Issue</h3><p>Adding or Removing Fields:</p>
<ul>
<li>removing a field from a oneof is considered a <strong>backward incompatible</strong> change. <ul>
<li>new version binary cannot process old version message</li>
<li>the information that may be lost is whether the oneof was really set or not</li>
</ul>
</li>
<li>adding a field to a oneof is considered a <strong>forward incompatible</strong> change<ul>
<li>old version binary cannot process new version message, just reverse of removing a field</li>
</ul>
</li>
</ul>
<p>Moving Fields:</p>
<ul>
<li>Moving fields out of a oneof:<ul>
<li>move a single field into a new oneof –&gt; safe</li>
<li>move multiple fields into a new oneof<ul>
<li>considered backward incompatible</li>
<li>but it can be safe when it is known that only one of the fields will be set</li>
</ul>
</li>
<li>move fields into a oneof<ul>
<li>same as “move multiple fields into a new oneof”</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Deleting a Oneof Fields and Add It Back</p>
<ul>
<li>similar to Removing Fields, but this situation there are 3 versions</li>
</ul>
<p>Splitting or Merging a Oneof</p>
<ul>
<li>similar to Moving Existing Fields into Oneof, backward incompatible.</li>
</ul>
<h2 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h2><h3 id="Features-1"><a href="#Features-1" class="headerlink" title="Features"></a>Features</h3><p><code>map&lt;key_type, value_type&gt; map_field = N;</code> will create a map field.</p>
<ul>
<li><code>key_type</code> can be <strong>integral type or string type</strong> (any scalar types except <strong>floating point</strong> and **bytes **type)</li>
<li><code>value_type</code> can be any type except another map type</li>
<li>map fields cannot be repeated</li>
<li>When parsing from wire, the last seen is used when there are duplicate keys</li>
</ul>
<h3 id="Backward-Compatibility"><a href="#Backward-Compatibility" class="headerlink" title="Backward Compatibility"></a>Backward Compatibility</h3><p>The map syntax is equivalent to the following on the wire</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">MapFieldEntry</span> &#123;</span><br><span class="line">  key_type key = <span class="number">1</span>;</span><br><span class="line">  value_type value = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">repeated</span> MapFieldEntry map_field = N;</span><br></pre></td></tr></table></figure>

<h2 id="Defining-a-Service"><a href="#Defining-a-Service" class="headerlink" title="Defining a Service"></a>Defining a Service</h2><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">service </span><span class="title class_">SearchService</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> Search(SearchRequest) <span class="keyword">returns</span> (SearchResponse)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JSON-Mapping"><a href="#JSON-Mapping" class="headerlink" title="JSON Mapping"></a>JSON Mapping</h2><p>When parsing JSON-encoded data into a protocol buffer</p>
<ul>
<li>if a value is missing or if its value is <code>null</code>, it will be corresponding <a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/proto3#default">default value</a>.</li>
</ul>
<p>When generating JSON-encoded output from a protocol buffer</p>
<ul>
<li>if a protobuf field has a default value will be omitted</li>
<li>A field that is defined with the <code>optional</code> keyword supports field presence.</li>
</ul>
<table>
<thead>
<tr>
<th align="left">proto3</th>
<th align="left">JSON</th>
<th align="left">JSON example</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left">message</td>
<td align="left">object</td>
<td align="left"><code>&#123;&quot;fooBar&quot;: v, &quot;g&quot;: null, …&#125;</code></td>
<td align="left">Generates JSON objects. Message field names are mapped to lowerCamelCase and become JSON object keys. If the <code>json_name</code> field option is specified, the specified value will be used as the key instead. Parsers accept both the lowerCamelCase name (or the one specified by the <code>json_name</code> option) and the original proto field name. <code>null</code> is an accepted value for all field types and treated as the default value of the corresponding field type.</td>
</tr>
<tr>
<td align="left">enum</td>
<td align="left">string</td>
<td align="left"><code>&quot;FOO_BAR&quot;</code></td>
<td align="left">The name of the enum value as specified in proto is used. Parsers accept both enum names and integer values.</td>
</tr>
<tr>
<td align="left">map&lt;K,V&gt;</td>
<td align="left">object</td>
<td align="left"><code>&#123;&quot;k&quot;: v, …&#125;</code></td>
<td align="left">All keys are converted to strings.</td>
</tr>
<tr>
<td align="left">repeated V</td>
<td align="left">array</td>
<td align="left"><code>[v, …]</code></td>
<td align="left"><code>null</code> is accepted as the empty list <code>[]</code>.</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">true, false</td>
<td align="left"><code>true, false</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">string</td>
<td align="left"><code>&quot;Hello World!&quot;</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">bytes</td>
<td align="left">base64 string</td>
<td align="left"><code>&quot;YWJjMTIzIT8kKiYoKSctPUB+&quot;</code></td>
<td align="left">JSON value will be the data encoded as a string using standard base64 encoding with paddings. Either standard or URL-safe base64 encoding with&#x2F;without paddings are accepted.</td>
</tr>
<tr>
<td align="left">int32, fixed32, uint32</td>
<td align="left">number</td>
<td align="left"><code>1, -10, 0</code></td>
<td align="left">JSON value will be a decimal number. Either numbers or strings are accepted.</td>
</tr>
<tr>
<td align="left">int64, fixed64, uint64</td>
<td align="left">string</td>
<td align="left"><code>&quot;1&quot;, &quot;-10&quot;</code></td>
<td align="left">JSON value will be a decimal string. Either numbers or strings are accepted.</td>
</tr>
<tr>
<td align="left">float, double</td>
<td align="left">number</td>
<td align="left"><code>1.1, -10.0, 0, &quot;NaN&quot;, &quot;Infinity&quot;</code></td>
<td align="left">JSON value will be a number or one of the special string values “NaN”, “Infinity”, and “-Infinity”. Either numbers or strings are accepted. Exponent notation is also accepted. -0 is considered equivalent to 0.</td>
</tr>
<tr>
<td align="left">Any</td>
<td align="left"><code>object</code></td>
<td align="left"><code>&#123;&quot;@type&quot;: &quot;url&quot;, &quot;f&quot;: v, … &#125;</code></td>
<td align="left">If the <code>Any</code> contains a value that has a special JSON mapping, it will be converted as follows: <code>&#123;&quot;@type&quot;: xxx, &quot;value&quot;: yyy&#125;</code>. Otherwise, the value will be converted into a JSON object, and the <code>&quot;@type&quot;</code> field will be inserted to indicate the actual data type.</td>
</tr>
<tr>
<td align="left">Timestamp</td>
<td align="left">string</td>
<td align="left"><code>&quot;1972-01-01T10:00:20.021Z&quot;</code></td>
<td align="left">Uses RFC 3339, where generated output will always be Z-normalized and uses 0, 3, 6 or 9 fractional digits. Offsets other than “Z” are also accepted.</td>
</tr>
<tr>
<td align="left">Duration</td>
<td align="left">string</td>
<td align="left"><code>&quot;1.000340012s&quot;, &quot;1s&quot;</code></td>
<td align="left">Generated output always contains 0, 3, 6, or 9 fractional digits, depending on required precision, followed by the suffix “s”. Accepted are any fractional digits (also none) as long as they fit into nano-seconds precision and the suffix “s” is required.</td>
</tr>
<tr>
<td align="left">Struct</td>
<td align="left"><code>object</code></td>
<td align="left"><code>&#123; … &#125;</code></td>
<td align="left">Any JSON object. See <code>struct.proto</code>.</td>
</tr>
<tr>
<td align="left">Wrapper types</td>
<td align="left">various types</td>
<td align="left"><code>2, &quot;2&quot;, &quot;foo&quot;, true, &quot;true&quot;, null, 0, …</code></td>
<td align="left">Wrappers use the same representation in JSON as the wrapped primitive type, except that <code>null</code> is allowed and preserved during data conversion and transfer.</td>
</tr>
<tr>
<td align="left">FieldMask</td>
<td align="left">string</td>
<td align="left"><code>&quot;f.fooBar,h&quot;</code></td>
<td align="left">See <code>field_mask.proto</code>.</td>
</tr>
<tr>
<td align="left">ListValue</td>
<td align="left">array</td>
<td align="left"><code>[foo, bar, …]</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Value</td>
<td align="left">value</td>
<td align="left"></td>
<td align="left">Any JSON value. Check <a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.Value">google.protobuf.Value</a> for details.</td>
</tr>
<tr>
<td align="left">NullValue</td>
<td align="left">null</td>
<td align="left"></td>
<td align="left">JSON null</td>
</tr>
<tr>
<td align="left">Empty</td>
<td align="left">object</td>
<td align="left"><code>&#123;&#125;</code></td>
<td align="left">An empty JSON object</td>
</tr>
</tbody></table>
<h1 id="Encoding"><a href="#Encoding" class="headerlink" title="Encoding"></a>Encoding</h1><h2 id="Principles"><a href="#Principles" class="headerlink" title="Principles"></a>Principles</h2><table>
<thead>
<tr>
<th align="left">ID</th>
<th align="left">Name</th>
<th align="left">Used For</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">VARINT</td>
<td align="left">int32, int64, uint32, uint64, sint32, sint64, bool, enum</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">I64</td>
<td align="left">fixed64, sfixed64, double</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">LEN</td>
<td align="left">string, bytes, embedded messages, packed repeated fields</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">SGROUP</td>
<td align="left">group start (deprecated)</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">EGROUP</td>
<td align="left">group end (deprecated)</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">I32</td>
<td align="left">fixed32, sfixed32, float</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">message    := (tag value)*</span><br><span class="line"></span><br><span class="line">tag        := (field &lt;&lt; 3) bit-or wire_type;</span><br><span class="line">                encoded as varint</span><br><span class="line">value      := varint      for wire_type == VARINT,</span><br><span class="line">              i32         for wire_type == I32,</span><br><span class="line">              i64         for wire_type == I64,</span><br><span class="line">              len-prefix  for wire_type == LEN,</span><br><span class="line">              &lt;empty&gt;     for wire_type == SGROUP or EGROUP</span><br><span class="line"></span><br><span class="line">varint     := int32 | int64 | uint32 | uint64 | bool | enum | sint32 | sint64;</span><br><span class="line">                encoded as varints (sintN are ZigZag-encoded first)</span><br><span class="line">i32        := sfixed32 | fixed32 | float;</span><br><span class="line">                encoded as 4-byte little-endian;</span><br><span class="line">                memcpy of the equivalent C types (u?int32_t, float)</span><br><span class="line">i64        := sfixed64 | fixed64 | double;</span><br><span class="line">                encoded as 8-byte little-endian;</span><br><span class="line">                memcpy of the equivalent C types (u?int32_t, float)</span><br><span class="line"></span><br><span class="line">len-prefix := size (message | string | bytes | packed);</span><br><span class="line">                size encoded as varint</span><br><span class="line">string     := valid UTF-8 string (e.g. ASCII);</span><br><span class="line">                max 2GB of bytes</span><br><span class="line">bytes      := any sequence of 8-bit bytes;</span><br><span class="line">                max 2GB of bytes</span><br><span class="line">packed     := varint* | i32* | i64*,</span><br><span class="line">                consecutive values of the type specified in `.proto`</span><br></pre></td></tr></table></figure>

<h1 id="Techniques"><a href="#Techniques" class="headerlink" title="Techniques"></a>Techniques</h1><h2 id="Steaming-Multiple-Messages"><a href="#Steaming-Multiple-Messages" class="headerlink" title="Steaming Multiple Messages"></a>Steaming Multiple Messages</h2><p>Similar to HTTP &amp; TCP, </p>
<ul>
<li>use bytes to transfer data</li>
<li>define the format of data</li>
<li>extract information from the data according to the format.</li>
</ul>
<h2 id="Large-Data-Sets"><a href="#Large-Data-Sets" class="headerlink" title="Large Data Sets"></a>Large Data Sets</h2><p>divide large data structure to smaller ones</p>
<h2 id="Self-Describing-Messages"><a href="#Self-Describing-Messages" class="headerlink" title="Self-Describing Messages"></a>Self-Describing Messages</h2><p>use <code>import &quot;google/protobuf/descriptor.proto&quot;</code></p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;google/protobuf/any.proto&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;google/protobuf/descriptor.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SelfDescribingMessage</span> &#123;</span><br><span class="line">  <span class="comment">// Set of FileDescriptorProtos which describe the type and its dependencies.</span></span><br><span class="line">  google.protobuf.FileDescriptorSet descriptor_set = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The message and its type, encoded as an Any message.</span></span><br><span class="line">  google.protobuf.Any message = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Fields-Presence"><a href="#Fields-Presence" class="headerlink" title="Fields Presence"></a>Fields Presence</h1><h2 id="Presence-Disciplines"><a href="#Presence-Disciplines" class="headerlink" title="Presence Disciplines"></a>Presence Disciplines</h2><p>Presence defines the <strong>semantics of translating</strong> between API representations and serialized representation</p>
<ul>
<li>The <em>no presence</em> discipline <strong>relies upon the field value</strong> to make decisions at (de)serialization time</li>
<li>The <em>explicit presence</em> discipline <strong>relies upon the explicit tracking state</strong></li>
</ul>
<h2 id="Presence-in-Wire-Format"><a href="#Presence-in-Wire-Format" class="headerlink" title="Presence in Wire Format"></a>Presence in Wire Format</h2><p>When serializing</p>
<ul>
<li>fields with <em>no presence</em> are not serialized if they contain their default value</li>
<li>fields with <em>presence</em> are serialized although they contain their default value</li>
</ul>
<p>When deserializing</p>
<ul>
<li>duplicate field values may be handled in different ways depending on the field definition<ul>
<li>Duplicate <code>repeated</code> fields are typically appended</li>
<li>Duplicate <code>optional</code> fields follows ‘the last one wins’ rules</li>
</ul>
</li>
<li>For enum fields, <em><strong>out-of-range values may be stored as unknown fields in the API</strong></em>, <strong>even though the wire-format tag was recognized</strong>.</li>
</ul>
<h2 id="Presence-in-Proto-3"><a href="#Presence-in-Proto-3" class="headerlink" title="Presence in Proto 3"></a>Presence in Proto 3</h2><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Field type</td>
<td><code>optional</code></td>
<td>Explicit Presence</td>
</tr>
<tr>
<td>Singular numeric (integer or floating point)</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>Singular enum</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>Singular string or bytes</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>Singular numeric (integer or floating point)</td>
<td>Yes</td>
<td>✔️</td>
</tr>
<tr>
<td>Singular enum</td>
<td>Yes</td>
<td>✔️</td>
</tr>
<tr>
<td>Singular string or bytes</td>
<td>Yes</td>
<td>✔️</td>
</tr>
<tr>
<td>Singular message</td>
<td>Yes</td>
<td>✔️</td>
</tr>
<tr>
<td>Singular message</td>
<td>No</td>
<td>✔️</td>
</tr>
<tr>
<td>Repeated</td>
<td>N&#x2F;A</td>
<td></td>
</tr>
<tr>
<td>Oneofs</td>
<td>N&#x2F;A</td>
<td>✔️</td>
</tr>
<tr>
<td>Maps</td>
<td>N&#x2F;A</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Semantics-of-Presence"><a href="#Semantics-of-Presence" class="headerlink" title="Semantics of Presence"></a>Semantics of Presence</h2><h3 id="Merging"><a href="#Merging" class="headerlink" title="Merging"></a>Merging</h3><p>If field presence is not tracked, then an update patch alone cannot represent an update to the default value, because only non-default values are merged-from.</p>
<p>Updating to set a default value in this case requires some external mechanism, such as <code>FieldMask</code>.</p>
<h3 id="Compatibility"><a href="#Compatibility" class="headerlink" title="Compatibility"></a>Compatibility</h3><p>binary compatible, but logically, there may be problems.</p>
<p>i.e. round trip between optional fields and non-optional fields</p>
<h1 id="Styles"><a href="#Styles" class="headerlink" title="Styles"></a>Styles</h1><ul>
<li><p><strong>Don’t</strong> Go from Repeated to Scalar</p>
</li>
<li><p><strong>Do</strong> Include an Unspecified Value in an Enum</p>
</li>
<li><p><strong>Do</strong> Use Well-Known Types and Common Types</p>
<ul>
<li><p>Well-Known Types:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/duration.proto">duration</a> is a signed, fixed-length span of time (for example, 42s).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/timestamp.proto">timestamp</a> is a point in time independent of any time zone or calendar (for example, 2017-01-15T01:30:15.01Z).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/field_mask.proto">field_mask</a> is a set of symbolic field paths (for example, f.b.d).</p>
</li>
</ul>
</li>
<li><p>Common Types:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/interval.proto">interval</a> is a time interval independent of time zone or calendar (for example, 2017-01-15T01:30:15.01Z - 2017-01-16T02:30:15.01Z).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/date.proto">date</a> is a whole calendar date (for example, 2005-09-19).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/dayofweek.proto">dayofweek</a> is a day of week (for example, Monday).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/timeofday.proto">timeofday</a> is a time of day (for example, 10:42:23).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/latlng.proto">latlng</a> is a latitude&#x2F;longitude pair (for example, 37.386051 latitude and -122.083855 longitude).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/money.proto">money</a> is an amount of money with its currency type (for example, 42 USD).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/postal_address.proto">postal_address</a> is a postal address (for example, 1600 Amphitheatre Parkway Mountain View, CA 94043 USA).</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/color.proto">color</a> is a color in the RGBA color space.</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/googleapis/googleapis/blob/master/google/type/month.proto">month</a> is a month of year (for example, April).</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>For extendible:</p>
<ul>
<li>Use different messages for storage and wire</li>
<li>Don’t Include Primitive Types in a Top-level Request or Response Proto</li>
<li>Never Use Booleans for Something That Has Two States Now, but Might Have More Later<ul>
<li>If you are using boolean for a field, make sure that the field is indeed describing just two possible states (for all time, not just now and the near future). </li>
<li>Often, the flexibility of an enum, int, or message turns out to be worth it.</li>
</ul>
</li>
<li>Rarely Use an Integer Field for an ID<ul>
<li>int64 is not as big as it used to be</li>
<li>can start with an internal message type</li>
</ul>
</li>
<li><em>Rarely</em> Define a Pagination API Without a Continuation Token</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Protobuf/" rel="tag"><i class="fa fa-tag"></i> Protobuf</a>
              <a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/01/20/Go-Compiler/" rel="prev" title="Go Compiler">
                  <i class="fa fa-chevron-left"></i> Go Compiler
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/01/22/gRPC/" rel="next" title="gRPC">
                  gRPC <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Anyu Elin</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">20k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">1:12</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
